<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PropDecoded • PoC</title>

  <!-- Leaflet (แผนที่) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    :root{
      --green:#2E7D5B; --green-100:#E9F6F0; --green-300:#BFE3D2;
      --teal:#1F6F63; --yellow:#F5E29E; --ink:#12333A; --muted:#6A7D80;
      --card:#fff; --shadow:0 8px 24px rgba(0,0,0,.08); --radius:16px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai","Prompt",Arial,sans-serif;background:linear-gradient(180deg,var(--green-100),#F7FAF9);color:var(--ink)}
    .container{max-width:1120px;margin:0 auto;padding:16px 20px 100px}
    .header{display:flex;align-items:center;justify-content:space-between;padding:8px 0 4px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;font-size:22px}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--green),var(--teal));display:grid;place-items:center;color:#fff;box-shadow:var(--shadow)}
    .topnav{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    .topnav a{text-decoration:none;color:var(--ink);opacity:.8;font-weight:600;padding:8px 12px;border-radius:12px}
    .topnav a.active{background:#fff;box-shadow:var(--shadow);opacity:1}
    .welcome{margin:12px 0 10px}
    .welcome h1{font-size:clamp(28px,6vw,46px);margin:10px 0 4px}

    .quick-grid{display:grid;gap:14px;grid-template-columns:repeat(4,1fr);margin:6px 0 10px}
    @media (max-width:960px){.quick-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.quick-grid{grid-template-columns:1fr}}
    .qcard{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer}
    .qicon{width:36px;height:36px;border-radius:10px;background:var(--green-300);display:grid;place-items:center;font-weight:900;color:var(--teal)}
    .qtitle{font-weight:800}.hint{color:var(--muted);font-size:13px;margin-top:2px}

    .lens-bar{margin:12px 0 12px}
    .seg{border:2px solid var(--green);border-radius:999px;padding:4px;display:inline-flex;gap:6px;background:#fff;box-shadow:var(--shadow)}
    .seg button{all:unset;padding:8px 14px;border-radius:999px;color:var(--green);font-weight:800;cursor:pointer}
    .seg button.active{background:linear-gradient(180deg,var(--green-300),#fff);color:var(--ink)}

    .main{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;align-items:start}
    @media (max-width:900px){.main{grid-template-columns:1fr}}
    #map{height:56vh;min-height:320px;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow)}

    .insight{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .badge{display:inline-block;background:var(--green-300);color:var(--teal);padding:6px 10px;border-radius:999px;font-weight:800;font-size:13px;margin-right:6px}
    .meter{height:10px;background:#ECF2F3;border-radius:999px;overflow:hidden}
    .meter>span{display:block;height:100%;background:linear-gradient(90deg,#CFEBDD,var(--yellow));width:40%}
    .kpi{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0}
    .card{background:#fff;border:1.5px solid #E5EFE9;border-radius:14px;padding:12px}
    .muted{color:var(--muted)} .btn{display:inline-flex;align-items:center;gap:8px;background:var(--green);color:#fff;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800}
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand"><div class="logo">PD</div><div>PropDecoded</div></div>
      <nav class="topnav">
        <a class="active" href="#">หน้าแรก</a>
        <a href="#">วิเคราะห์พื้นที่</a>
        <a href="#">รีวิว</a>
        <a href="#" id="openContact">ติดต่อเรา</a>
      </nav>
    </header>

    <section class="welcome"><h1>ยินดีต้อนรับ</h1></section>

    <!-- เมนูด่วน 4 อัน -->
    <section class="quick-grid" aria-label="เมนูด่วน">
      <div class="qcard" data-action="get-started"><div class="qicon">➤</div><div><div class="qtitle">เริ่มต้นใช้งาน</div><div class="hint">เลือกเลนส์แล้วเริ่มสำรวจ</div></div></div>
      <div class="qcard" data-action="insights"><div class="qicon">⌁</div><div><div class="qtitle">บทวิเคราะห์</div><div class="hint">อ่าน insight ที่คัดสรร</div></div></div>
      <div class="qcard" data-action="legal"><div class="qicon">§</div><div><div class="qtitle">ข้อกฎหมายที่ควรทราบ</div><div class="hint">ข้อมูลกลางเพื่อประกอบความเข้าใจ</div></div></div>
      <div class="qcard" data-action="contact"><div class="qicon">☎</div><div><div class="qtitle">ติดต่อเรา</div><div class="hint">ส่งข้อความถึงทีมงาน</div></div></div>
    </section>

    <!-- ปุ่มสลับ 3 เลนส์ -->
    <section class="lens-bar">
      <div class="seg" role="tablist" aria-label="มุมมองข้อมูล">
        <button class="active" id="lens-tenant" role="tab" aria-selected="true">ผู้เช่า</button>
        <button id="lens-investor" role="tab" aria-selected="false">นักลงทุน</button>
        <button id="lens-renovator" role="tab" aria-selected="false">รีโนเวท/ดีเวลอป</button>
      </div>
    </section>

    <!-- เนื้อหาหลัก -->
    <section class="main">
      <div id="map" aria-label="แผนที่"></div>

      <aside class="insight" id="insightPanel">
        <span class="badge" id="lensTag">ผู้เช่า</span>
        <h3 id="areaTitle">กรุงเทพฯ</h3>
        <div class="muted" id="subtitle">ภาพรวมสำหรับผู้อยู่อาศัย</div>

        <div style="margin:12px 0 6px;font-weight:800">ตัวชี้วัดหลัก</div>
        <div class="meter"><span id="meterFill" style="width:60%"></span></div>

        <div class="kpi">
          <div class="card"><h4>ข้อมูลย่อ</h4><div class="muted" id="kpiLeftDesc">CBD ~ 18 นาที • BTS ~ 6 นาที</div></div>
          <div class="card"><h4 id="kpiRightTitle">รีวิวล่าสุด</h4><div class="muted" id="kpiRightDesc">“ย่านเงียบช่วงกลางคืน มีร้านสะดวกซื้อใกล้ ๆ”</div></div>
        </div>

        <details open><summary><b>รายละเอียด</b></summary>
          <p class="muted" id="detailsText">• ข้อความรายละเอียดจะโหลดจากไฟล์ JSON ของแต่ละเลนส์</p>
        </details>

        <button class="btn" id="seeMore">ดูรายละเอียดเชิงลึก</button>
      </aside>
    </section>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ---------- แผนที่ Leaflet ----------
    const map = L.map('map').setView([13.736, 100.532], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(map);
    [
      { name:'อโศก',    lat:13.737, lng:100.561 },
      { name:'ทองหล่อ', lat:13.724, lng:100.579 },
      { name:'สาทร',    lat:13.718, lng:100.530 }
    ].forEach(s => L.marker([s.lat,s.lng]).addTo(map).bindPopup(`<b>${s.name}</b>`));

    // ---------- UI อ้างอิง ----------
    const lensBtns = {
      tenant:   document.getElementById('lens-tenant'),
      investor: document.getElementById('lens-investor'),
      renovator:document.getElementById('lens-renovator')
    };
    const ui = {
      lensTag:       document.getElementById('lensTag'),
      subtitle:      document.getElementById('subtitle'),
      meterFill:     document.getElementById('meterFill'),
      kpiLeftDesc:   document.getElementById('kpiLeftDesc'),
      kpiRightTitle: document.getElementById('kpiRightTitle'),
      kpiRightDesc:  document.getElementById('kpiRightDesc'),
      detailsText:   document.getElementById('detailsText')
    };

    // ---------- ข้อมูลสำรอง (fallback) ----------
    const fallback = {
      tenant:{ tag:'ผู้เช่า', subtitle:'ภาพรวมสำหรับผู้อยู่อาศัย', meter:0.62,
        kpiLeftDesc:'CBD ~ 18 นาที • BTS ~ 6 นาที',
        kpiRightTitle:'รีวิวล่าสุด',
        kpiRightDesc:'“เงียบช่วงกลางคืน เดินไปสถานีได้”',
        detailsText:'• ร้าน/คาเฟ่ระยะเดินถึง • เย็นรถติดแต่มี BTS'
      },
      investor:{ tag:'นักลงทุน', subtitle:'โอกาสลงทุนและปัจจัยเสี่ยง', meter:0.72,
        kpiLeftDesc:'ราคา/ตร.ม. ช่วงกลาง–บน',
        kpiRightTitle:'Opportunity',
        kpiRightDesc:'Yield proxy ~ 5.6% • Resilience: ดี',
        detailsText:'• ฟื้นตัวราคาเร็ว • ผู้เช่าตปท.ปานกลาง–สูง'
      },
      renovator:{ tag:'รีโนเวท/ดีเวลอป', subtitle:'ศักยภาพเพิ่มมูลค่า', meter:0.5,
        kpiLeftDesc:'อายุอาคาร ~ กลาง',
        kpiRightTitle:'Value Uplift',
        kpiRightDesc:'Quick wins: แสง/ไฟ, งานสี',
        detailsText:'• แสงธรรมชาติน้อย ➜ เปลี่ยนไฟ/ซีลประตู'
      }
    };

    async function loadLens(l){
      try{
        const r = await fetch(`${l}.json?v=${Date.now()}`, {cache:'no-store'});
        if(!r.ok) throw 0;
        return await r.json();
      }catch{ return fallback[l]; }
    }

    async function apply(l){
      localStorage.setItem('pd_lens', l);
      Object.entries(lensBtns).forEach(([id,b])=> b?.classList.toggle('active', id===l));
      const c = await loadLens(l);
      ui.lensTag.textContent = c.tag || '';
      ui.subtitle.textContent = c.subtitle || '';
      if(ui.meterFill) ui.meterFill.style.width = Math.round((c.meter||0)*100)+'%';
      ui.kpiLeftDesc.textContent = c.kpiLeftDesc || '';
      ui.kpiRightTitle.textContent = c.kpiRightTitle || '';
      ui.kpiRightDesc.textContent = c.kpiRightDesc || '';
      if(ui.detailsText) ui.detailsText.innerHTML = c.detailsText || '';
    }

    lensBtns.tenant   ?.addEventListener('click', ()=>apply('tenant'));
    lensBtns.investor ?.addEventListener('click', ()=>apply('investor'));
    lensBtns.renovator?.addEventListener('click', ()=>apply('renovator'));

    apply(localStorage.getItem('pd_lens') || 'tenant');

    // การ์ด "เริ่มต้นใช้งาน" ให้เลื่อนมาที่สวิตช์เลนส์
    document.querySelector('[data-action="get-started"]')
      ?.addEventListener('click', ()=> document.querySelector('
