<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PropDecoded • PoC (minimal)</title>

<!-- Leaflet (แผนที่) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  :root{
    --green:#2E7D5B; --teal:#1F6F63; --yellow:#F5E29E;
    --ink:#12333A; --muted:#6A7D80; --card:#fff;
    --shadow:0 8px 24px rgba(0,0,0,.08); --r:16px;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,"Noto Sans Thai",Prompt,Arial,sans-serif;background:#F4FAF7;color:var(--ink)}
  .wrap{max-width:1100px;margin:0 auto;padding:16px 20px 80px}
  header{display:flex;align-items:center;justify-content:space-between;margin:6px 0 10px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--green),var(--teal));color:#fff;display:grid;place-items:center;box-shadow:var(--shadow)}
  .lens{margin:12px 0;display:flex;gap:8px;flex-wrap:wrap}
  .lens button{all:unset;border-radius:999px;padding:9px 14px;border:2px solid var(--green);color:var(--green);cursor:pointer;font-weight:800;background:#fff}
  .lens button.active{background:linear-gradient(180deg,#DDEFE6,#fff);color:var(--ink)}
  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;align-items:start}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  #map{height:58vh;min-height:320px;border-radius:var(--r);box-shadow:var(--shadow)}
  .card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);padding:16px}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#DDEFE6;color:var(--teal);font-weight:800;margin-right:6px}
  .meter{height:10px;background:#E8EFEA;border-radius:999px;overflow:hidden;margin:10px 0}
  .meter>span{display:block;height:100%;background:linear-gradient(90deg,#CFEBDD,var(--yellow));width:50%}
  .kpi{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
  .kpi .cell{background:#FAFCFB;border:1.5px solid #E5EFE9;border-radius:12px;padding:10px}
  h1{margin:8px 0 2px}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand"><div class="logo">PD</div><div>PropDecoded</div></div>
    <div class="muted">PoC minimal</div>
  </header>

  <h1>ยินดีต้อนรับ</h1>
  <div class="lens" role="tablist" aria-label="เลนส์">
    <button id="lens-tenant" class="active" role="tab" aria-selected="true">ผู้เช่า</button>
    <button id="lens-investor" role="tab" aria-selected="false">นักลงทุน</button>
    <button id="lens-renovator" role="tab" aria-selected="false">รีโนเวท/ดีเวลอป</button>
  </div>

  <div class="grid">
    <div id="map" aria-label="แผนที่"></div>

    <aside class="card">
      <span class="badge" id="tag">ผู้เช่า</span>
      <h3 id="title">วัฒนา</h3>
      <div class="muted" id="subtitle">ภาพรวมสำหรับผู้อยู่อาศัย</div>

      <div style="font-weight:800;margin-top:10px">ตัวชี้วัดหลัก</div>
      <div class="meter"><span id="meter" style="width:60%"></span></div>

      <div class="kpi">
        <div class="cell"><div class="muted" id="kpiLeft">CBD ~ 18 นาที • BTS ~ 6 นาที</div></div>
        <div class="cell"><div style="font-weight:800" id="kpiRightTitle">รีวิวล่าสุด</div>
          <div class="muted" id="kpiRight">“ย่านเงียบช่วงกลางคืน มีร้านสะดวกซื้อใกล้ ๆ”</div></div>
      </div>

      <div style="margin-top:10px" class="muted" id="details">• ตัวอย่างรายละเอียด</div>
    </aside>
  </div>
</div>

<script>
/* ---------- ข้อมูลแบบฝังไว้ (ไม่ต้องโหลดไฟล์แยก) ---------- */
const DATA = {
  tenant:{ tag:'ผู้เช่า', subtitle:'ภาพรวมสำหรับผู้อยู่อาศัย', meter:0.62,
    kpiLeft:'CBD ~ 18 นาที • BTS ~ 6 นาที',
    kpiRightTitle:'รีวิวล่าสุด',
    kpiRight:'“เงียบช่วงกลางคืน เดินไปสถานีได้”',
    details:'• ปลอดภัยในตรอกซอยหลัก<br>• ร้านอาหารท้องถิ่นเยอะ เดินได้<br>• รถติดช่วงเย็นแต่มี BTS เป็นทางเลือก'
  },
  investor:{ tag:'นักลงทุน', subtitle:'โอกาสลงทุนและปัจจัยเสี่ยง (โทนเป็นกลาง)', meter:0.72,
    kpiLeft:'ราคา/ตร.ม. (ช่วง) • ตัวอย่าง',
    kpiRightTitle:'Opportunity',
    kpiRight:'Yield proxy ~ 5.6% • Resilience: ดี',
    details:'• Disaster Resilience: ฟื้นตัวไว<br>• Foreign Buyer Pressure: ปานกลาง<br>• ROI Gap: สูงกว่าพื้นที่รอบข้างเล็กน้อย'
  },
  renovator:{ tag:'รีโนเวท/ดีเวลอป', subtitle:'ศักยภาพเพิ่มมูลค่าจากการปรับปรุง', meter:0.50,
    kpiLeft:'อายุอาคาร ~ กลาง • สภาพรวม: มาตรฐาน',
    kpiRightTitle:'Value Uplift',
    kpiRight:'Quick wins: แสง/ไฟ, งานสี, วัสดุพื้นผิว',
    details:'• Pain points: แสงน้อย/เสียงรบกวนบ้าง<br>• ไอเดีย: เปลี่ยนไฟ/ซีลประตู/ปรับผ้าม่าน'
  }
};

/* ---------- แผนที่ ---------- */
let map;
document.addEventListener('DOMContentLoaded', () => {
  map = L.map('map').setView([13.736, 100.523], 12); // ใจกลาง กทม.
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap'
  }).addTo(map);
  L.marker([13.736,100.523]).addTo(map).bindPopup('กรุงเทพฯ').openPopup();

  // initial lens
  applyLens(localStorage.getItem('pd_lens') || 'tenant');
});

/* ---------- สลับเลนส์ ---------- */
const btns = {
  tenant: document.getElementById('lens-tenant'),
  investor: document.getElementById('lens-investor'),
  renovator: document.getElementById('lens-renovator')
};
Object.entries(btns).forEach(([id,btn])=>{
  btn.addEventListener('click', ()=> applyLens(id));
});

const tag = document.getElementById('tag');
const subtitle = document.getElementById('subtitle');
const meter = document.getElementById('meter');
const kpiLeft = document.getElementById('kpiLeft');
const kpiRightTitle = document.getElementById('kpiRightTitle');
const kpiRight = document.getElementById('kpiRight');
const details = document.getElementById('details');

function applyLens(lens){
  localStorage.setItem('pd_lens', lens);
  Object.entries(btns).forEach(([id,btn])=>{
    btn.classList.toggle('active', id===lens);
    btn.setAttribute('aria-selected', id===lens ? 'true':'false');
  });
  const c = DATA[lens];
  tag.textContent = c.tag;
  subtitle.textContent = c.subtitle;
  meter.style.width = Math.round(c.meter*100)+'%';
  kpiLeft.textContent = c.kpiLeft;
  kpiRightTitle.textContent = c.kpiRightTitle;
  kpiRight.textContent = c.kpiRight;
  details.innerHTML = c.details;

  // ตัวอย่าง: ขยับ marker เล็กน้อยตามเลนส์ (เพื่อเห็นแผนที่ตอบสนอง)
  if(map){
    const offsets = { tenant:[0,0], investor:[0.01,-0.005], renovator:[-0.01,0.005] };
    const base = [13.736,100.523];
    const d = offsets[lens];
    const p = [base[0]+d[0], base[1]+d[1]];
    map.panTo(p, {animate:true, duration:.5});
  }
}
</script>
</body>
</html>
